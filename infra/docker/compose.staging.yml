
version: "3.9"
name: m0club-staging

services:
  postgres:
    image: postgres:16
    environment:
      POSTGRES_USER: m0
      POSTGRES_PASSWORD: m0
      POSTGRES_DB: m0club
    volumes:
      - pgdata:/var/lib/postgresql/data

  redis:
    image: redis:7

  api:
    image: ghcr.io/m0club/api-gateway:staging
    environment:
      RUST_LOG: info
      M0_LOG_JSON: "1"
      M0_API_KEYS: "${M0_API_KEYS:-}"
    ports:
      - "8080:8080"

  realtime:
    image: ghcr.io/m0club/realtime:staging
    ports:
      - "8090:8090"

  indexer:
    image: ghcr.io/m0club/indexer:staging
    environment:
      RUST_LOG: info
    command: ["m0-indexer", "--rpc-url", "${SOLANA_RPC_URL:-https://api.mainnet-beta.solana.com}"]

  jobs:
    image: ghcr.io/m0club/jobs:staging
    command: ["m0-jobs", "--interval-secs", "60"]

  dashboard:
    image: ghcr.io/m0club/dashboard:staging
    environment:
      NEXT_PUBLIC_API_BASE: "${DASH_API_BASE:-https://api-staging.m0club.com}"
      NEXT_PUBLIC_WS_URL: "${DASH_WS_URL:-wss://realtime-staging.m0club.com/ws}"
    ports:
      - "3000:3000"

volumes:
  pgdata:
